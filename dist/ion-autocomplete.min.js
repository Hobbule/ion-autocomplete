/*
 * ion-autocomplete 0.4.3
 * Copyright 2017 Danny Povolotski 
 * Copyright modifications 2017 Guy Brand 
 * https://github.com/guylabs/ion-autocomplete
 */
!function(){"use strict";angular.module("ion-autocomplete",[]).directive("ionAutocomplete",["$ionicScrollDelegate","$document","$q","$parse","$interpolate","$ionicPlatform","$compile","$ionicModal",function(a,b,c,d,e,f,g,h){return{require:["ngModel","ionAutocomplete"],restrict:"A",scope:{},bindToController:{ngModel:"=",externalModel:"=",templateData:"=",maxSelectedItems:"=",itemsMethod:"&",itemsClickedMethod:"&",itemsRemovedMethod:"&",modelToItemMethod:"&",cancelButtonClickedMethod:"&",placeholder:"@",cancelLabel:"@",selectItemsLabel:"@",selectedItemsLabel:"@",templateUrl:"@",itemValueKey:"@",itemViewValueKey:"@",autoOpen:"="},controllerAs:"viewModel",controller:["$attrs","$timeout","$scope",function(a,b,c){var d=function(a,b){return a?a:b},f=this;b(function(){f.placeholder=d(f.placeholder,"Click to enter a value..."),f.cancelLabel=d(f.cancelLabel,"Done"),f.selectItemsLabel=d(f.selectItemsLabel,"Select an item..."),f.selectedItemsLabel=d(f.selectedItemsLabel,e("Selected items{{maxSelectedItems ? ' (max. ' + maxSelectedItems + ')' : ''}}:")(f)),f.templateUrl=d(f.templateUrl,void 0),f.itemValueKey=d(f.itemValueKey,void 0),f.itemViewValueKey=d(f.itemViewValueKey,void 0),f.autoOpen=d(f.autoOpen,!1)}),this.itemsMethodValueKey=d(a.itemsMethodValueKey,void 0),this.componentId=d(a.componentId,void 0),this.loadingIcon=d(a.loadingIcon,void 0),this.manageExternally=d(a.manageExternally,"false"),this.clearOnSelect=d(a.clearOnSelect,"true"),this.ngModelOptions=d(c.$eval(a.ngModelOptions),{}),this.showLoadingIcon=!1,this.searchItems=[],this.selectedItems=[],this.searchQuery=void 0,this.isArray=function(a){return angular.isArray(a)}}],link:function(b,g,i,j){var k=j[0],l=j[1],m=['<ion-modal-view><ion-header-bar class="item-input-inset">','<label class="item-input-wrapper">','<i class="icon ion-search placeholder-icon"></i>','<input type="search" class="ion-autocomplete-search" ng-model="viewModel.searchQuery" ng-model-options="viewModel.ngModelOptions" placeholder="{{viewModel.placeholder}}"/>',"</label>",'<div class="ion-autocomplete-loading-icon" ng-if="viewModel.showLoadingIcon && viewModel.loadingIcon"><ion-spinner icon="{{viewModel.loadingIcon}}"></ion-spinner></div>','<button class="ion-autocomplete-cancel button button-clear button-dark" ng-click="viewModel.cancelClick()">{{viewModel.cancelLabel}}</button>',"</ion-header-bar>","<ion-content>","<ion-list>",'<ion-item class="item-divider">{{viewModel.selectedItemsLabel}}</ion-item>','<ion-item ng-if="viewModel.isArray(viewModel.selectedItems)" ng-repeat="selectedItem in viewModel.selectedItems track by $index" class="item-icon-left item-icon-right item-text-wrap">','<i class="icon ion-checkmark"></i>',"{{viewModel.getItemValue(selectedItem, viewModel.itemViewValueKey)}}",'<i class="icon ion-trash-a" style="cursor:pointer" ng-click="viewModel.removeItem($index)"></i>',"</ion-item>",'<ion-item ng-if="!viewModel.isArray(viewModel.selectedItems)" class="item-icon-left item-icon-right item-text-wrap">','<i class="icon ion-checkmark"></i>',"{{viewModel.getItemValue(viewModel.selectedItems, viewModel.itemViewValueKey)}}",'<i class="icon ion-trash-a" style="cursor:pointer" ng-click="viewModel.removeItem(0)"></i>',"</ion-item>",'<ion-item class="item-divider" ng-if="viewModel.searchItems.length > 0">{{viewModel.selectItemsLabel}}</ion-item>','<ion-item ng-repeat="item in viewModel.searchItems track by $index" item-height="55px" item-width="100%" ng-click="viewModel.selectItem(item)" class="item-text-wrap">',"{{viewModel.getItemValue(item, viewModel.itemViewValueKey)}}","</ion-item>","</ion-list>","</ion-content>","</ion-modal-view>"].join("");c.when().then(function(){return l.templateUrl?h.fromTemplateUrl(l.templateUrl,{scope:b,animation:"slide-in-up",focusFirstInput:!0}):h.fromTemplate(m,{scope:b,animation:"slide-in-up",focusFirstInput:!0})}).then(function(h){var j=angular.element(h.$el.find("input"));"false"==l.manageExternally&&g[0].addEventListener("focus",function(a){l.searchQuery=void 0,l.showModal()}),l.getItemValue=function(a,b){if(angular.isArray(a)){var c=[];return angular.forEach(a,function(e){b&&angular.isObject(a)?c.push(d(b)(e)):c.push(e)}),c}return b&&angular.isObject(a)?d(b)(a):a},l.selectItem=function(a){"true"==l.clearOnSelect&&(l.searchQuery=void 0),"1"!=l.maxSelectedItems&&angular.isArray(l.selectedItems)&&l.maxSelectedItems<=l.selectedItems.length||(n(l.selectedItems,l.itemValueKey,l.getItemValue(a,l.itemValueKey))||("1"==l.maxSelectedItems?l.selectedItems=a:l.selectedItems=l.selectedItems.concat([a])),k.$setViewValue(l.selectedItems),k.$render(),1==l.maxSelectedItems&&l.hideModal(),angular.isDefined(i.itemsClickedMethod)&&l.itemsClickedMethod({callback:{item:a,selectedItems:angular.isArray(l.selectedItems)?l.selectedItems.slice():l.selectedItems,selectedItemsArray:angular.isArray(l.selectedItems)?l.selectedItems.slice():[l.selectedItems],componentId:l.componentId}}))},l.removeItem=function(a){if(angular.isArray(l.selectedItems)){var b=l.selectedItems.splice(a,1)[0];l.selectedItems=l.selectedItems.slice()}else l.selectedItems=[];k.$setViewValue(l.selectedItems),k.$render(),angular.isDefined(i.itemsRemovedMethod)&&l.itemsRemovedMethod({callback:{item:b,selectedItems:angular.isArray(l.selectedItems)?l.selectedItems.slice():l.selectedItems,selectedItemsArray:angular.isArray(l.selectedItems)?l.selectedItems.slice():[l.selectedItems],componentId:l.componentId}})},b.$watch("viewModel.searchQuery",function(a){l.fetchSearchQuery(a,!1)}),b.$watch("viewModel.maxSelectedItems",function(a){l.maxSelectedItems!=a&&(l.selectedItemsLabel=e("Selected items{{maxSelectedItems ? ' (max. ' + maxSelectedItems + ')' : ''}}:")(l))}),l.fetchSearchQuery=function(b,d){if(void 0!==b&&angular.isDefined(i.itemsMethod)){l.showLoadingIcon=!0;var e={query:b,isInitializing:d};l.componentId&&(e={query:b,isInitializing:d,componentId:l.componentId});var f=c.when(l.itemsMethod(e));f.then(function(b){b&&(b&&b.data&&(b=b.data),l.searchItems=l.getItemValue(b,l.itemsMethodValueKey),a.resize())},function(a){return c.reject(a)}).finally(function(){l.showLoadingIcon=!1})}};var m=!1;l.showModal=function(){m||(h.show(),b.$deregisterBackButton=f.registerBackButtonAction(function(){l.hideModal()},300),l.fetchSearchQuery("",!0),a.resize(),m=!0)},l.hideModal=function(){l.searchQuery=void 0,h.hide(),b.$deregisterBackButton&&b.$deregisterBackButton(),m=!1};var n=function(a,b,c){if(angular.isArray(a))for(var d=0;d<a.length;d++)if(l.getItemValue(a[d],b)===c)return!0;return!1},o=function(a){var b=c.when(l.modelToItemMethod({modelValue:a}));b.then(function(a){l.selectItem(a)},function(a){return c.reject(a)})};l.cancelClick=function(){l.hideModal(),angular.isDefined(i.cancelButtonClickedMethod)&&l.cancelButtonClickedMethod({callback:{selectedItems:angular.isArray(l.selectedItems)?l.selectedItems.slice():l.selectedItems,selectedItemsArray:angular.isArray(l.selectedItems)?l.selectedItems.slice():[l.selectedItems],componentId:l.componentId}})},b.$watch("viewModel.externalModel",function(a){return angular.isArray(a)&&0==a.length?(l.selectedItems=[],k.$setViewValue(l.selectedItems),void k.$render()):void(a&&angular.isDefined(i.modelToItemMethod)&&(angular.isArray(a)?(l.selectedItems=[],angular.forEach(a,function(a){o(a)})):o(a)))}),b.$on("$destroy",function(){j.remove()}),k.$render=function(){g.val(l.getItemValue(k.$viewValue,l.itemViewValueKey))},k.$formatters.push(function(a){var b=l.getItemValue(a,l.itemViewValueKey);return void 0==b?"":b}),k.$parsers.push(function(a){return l.getItemValue(a,l.itemValueKey)}),l.autoOpen&&l.showModal()})}}}])}();